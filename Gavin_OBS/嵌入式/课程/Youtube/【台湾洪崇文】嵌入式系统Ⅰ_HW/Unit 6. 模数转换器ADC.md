> 大纲：
> 1. ADC的基本观念
> 2. 采样时间和采样保持
> 3. 解析度、电压转换、和有效位数
> 4. 采样时间观念与触发
> 5. PDG2的ADC设定


## Section 1. ADC的基本概念

数字信号和模拟信号：
- 模拟信号： 模拟信号是连续的，自然界中的信号多是模拟信号
	- 比如：电压、电流、身高……
- 数字信号：以二进制为基础，只有0 1 ， 没有中间值，数字信号再电脑中逻辑使用：
	- 1-0，High-Low；
	- 一系列的二进制数字加权，可以构成较大的数字系统；

数字信号的转换：
- 传感器吧各种物理量，转换成处理器可以处理的信号；
- 把各种信息通过传感器转化成连续的电压值：
	- 声音可以通过麦克风转换成电压信号；
	- 光敏电阻的电阻随着照度改变，串联电阻形成分压；

模拟信号的转换：
- 处理器由ADC将连续电压信号转换为明确的数值；
- 以下几个数值表示ADC的效能：
	- 位元数；（解析度）
	- 最短采样时间；（转换时间--从模拟电压的输入，到得到数字信号的时间间隔）
	- 电压范围、有效位数、INL、DNL；（ADC的线性度）

ADC和离散信号：
- 把外界信号采样的过程，就是一个离散化的过程。将一个60Hz的弦波采样50个点并且将范围由0~1转换为0~511（8bit）；

![](https://raw.githubusercontent.com/DustOfStars/ObsPicGo/master/Gavin_Obs/20221114171620.png)


## Section 2. 采样时间和采样保持

> 最短采样时间：conversation time，从ADC的一次触发采样，到转换完成的时间；
> 最短取样时间的计算公式：
> 		tD + tSPLSH + tDIAG + (tCONV × n) + tED
> 		1. tD : 触发延迟
> 		2. tSPLSH : 取样保持消耗时间（选取功能）
> 		3. tDIAG : 自我测试时间（选取功能）
> 		4. tCONV : 转换时间
> 		5. n : 使用的通道数
> 		6. tED : 转换结束延迟


采样保持：
- RX62T的ADC，一个单元有4个通道，三个独立采样保持电路（sample & hold）；
- **采样保持电路的功能是维持触发时间的电压准位，等待转换器完成转换**；
- 四个channel只能有一个在转换，许多时候需要采样类比值，但是ADC个数不够，因此**同时取样，分时转换**！！
	- 三相电力系统的电压、电流…
- 借由采样保持电路可以采样到同一时间的信号；

![三相电力系统的ADC采样保持](https://raw.githubusercontent.com/DustOfStars/ObsPicGo/master/Gavin_Obs/20221114173220.png)


## Section 3. 解析度与电压转换

### 3.1 解析度

- 表示ADC转换出来的数值范围的二进制位数；
	- 通常以位元数表示，RX62T的ADC最高解析度是12bit；
- 参考电压：**提供ADC做模数转换时的基准**；
- 输入电压范围（参考电压）被分成几个等份（2^bit位数）；
	- 输入电压范围= 低参考电压 ~ 高参考电压；
	- 部分处理器低参考电压固定为0；
	- 输入电压范围 = （高）参考电压
- 当输入信号范围小于ADC的输入范围，**会导致有效解析度下降**；
	- **最小解析度（1bit）电压 = 输入电压范围 / 2^bit位数**
	- 可由内建的放大器或外接放大器调整输入信号；
- RX62T的ADC 12bit，表示输入电压范围被切割为 2^12 = 4096 份；
- 以参考电压设为5V为例，解析度12bit表示，5  / 4096 = 0.0012V;
- PDG2可以设定的解析度有：
	- 12bit、10bit、8bit

### 3.2 ADC架构

常见的ADC架构和特点：
- **快闪式（Flash）ADC：速度最快，所占晶圆面积最大**；
- **三角积分式（Delta-Sigma）ADC：过采样和杂讯移频计数，速度较慢，解析度可达20bit以上**；
- **连续渐进法（Successive approximation）ADC：模拟输出比较，依次逼近，转换速度和解析度适中**；

### 3.3 电压转换

<mark>转换电压的公式： V = Result × Vref ÷ 2^accuracy</mark>

**Result : ADC读到的数字值；accuracy是ADC的解析度； Result乘以单位份的电压值，就是转换之后真正的电压值V；**


## Section 4. 采样时间观念

采样定理：
- 有限频宽之间的连续时间信号，经过大于宽频的2倍采样频率采样，理论上，原来的连续信号可以从优先采样样本中完全恢复。
- 在时域上的每隔Ts采样，等同于在频域上原始信号频谱与间隔Fs（1/Ts）脉冲串列做回旋积分（卷积，convolution）；
- 等同于在频域上每隔采样频率Fs（1/Ts）复制频谱；

混叠现象（Aliasing Effect）：
- 时域上每隔Ts时间采样，等同于在频域上每隔采样频率Fs（1/Ts）复制频谱；
![](https://raw.githubusercontent.com/DustOfStars/ObsPicGo/master/Gavin_Obs/20221115150338.png)
- 从上面图可以看到，**所以Fs如果不大于 频宽的两倍，即频谱大于采样频率的1/2，信号就会发生重叠**；**即推导出了一个采样间隔的最小值！**！


采样频率实践：
- 采样频率大于2倍频宽以上是理论要求
	- **较少采样理论最少的频率去重建原始信号，因为运算量太大**！
- **一般采样频率建议在5~10倍**；
	- 可以直接做参数量测估算；

克服混叠现象：
- 解决方法：
	- 加入**低通滤波器或者带通滤波器**，滤除1/2采样频宽以上的信号，避免高频成分影响；
	- **提高采样频率，使它大于信号频宽的2倍**！


## Section 5. 使用PDG2设定ADC

采样触发：
- 告诉ADC开始采样转换程序；
- RX62T的ADC允许使用多种触发来源：
	- 一般使用固定的采样频率，可以使用GPT或者MTU等计时器触发；
	- 也能由capture功能触发，由外部硬件提供；
	- 软件触发；
		- 软件触发由代码告诉ADC开始取样转换，可以自由安排，但是会占用CPU资源，触发的时间间隔不一；
- ADC也可以连续采样
	- 理论上用最快取样时间转换；
	- 没有准确的采样实践，保持最新的采样转换结果；
	- 在需要时候取出结果，时间的误差小于每一次采样转换时间；

采样模式：
- ADC的采样模式有四种
	- Single 一次触发单次采样
	- One-Cycle scan ： 一次触发数个通道依次采样后停止；
	- Continues scan： 一次触发数个通道连续依次采样；
	- 2-channel scan：两组输入，使用不同触发来源；

内部放大与转换时间：
- 设定内部放大器放大，提高ADC的有效解析度；
- 设定转换时间，ADCLK用在最快；
- 开启中断


## Section 6. 连续转换与数值显示实操

> PDG2的设定；
> 程序流程；
> 采样数值与波形显示；

![](https://raw.githubusercontent.com/DustOfStars/ObsPicGo/master/Gavin_Obs/20221115153404.png)








[[2022-11-14_星期一]]
